<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost Speed Race</title>
    
    <meta property="og:title" content="Ghost Keyboard Race">
    <meta property="og:description" content="Invisible keys. Maximum speed. Can you beat me?">

    <style>
        :root {
            --bg-color: #121212;
            --text-color: #ffffff;
            --accent-color: #00ff88; 
            --key-bg: #4a4a4c; /* iPhone tu≈ü rengine daha yakƒ±n */
            --key-active: #ffffff;
            --key-text-active: #000000;
            --wrong-color: #ff4444;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100dvh; /* iOS Safari fix */
            margin: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            padding-bottom: calc(5px + env(safe-area-inset-bottom)); 
            position: relative;
        }

        /* -- HUD -- */
        .timer-box {
            font-size: 3rem;
            font-weight: 800;
            color: #fff;
            text-align: center;
            font-variant-numeric: tabular-nums;
            opacity: 0.9;
            margin-top: 10px;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }

        .target-box {
            background: rgba(30,30,30, 0.8);
            padding: 20px;
            border-radius: 18px;
            text-align: center;
            margin: 15px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .target-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color);
            line-height: 1.4;
        }

        .input-display {
            font-size: 1.4rem;
            min-height: 40px;
            border-bottom: 2px solid #444;
            margin-bottom: 20px;
            text-align: center;
            white-space: pre; 
            color: #fff;
            font-family: monospace;
            letter-spacing: 1px;
        }

        /* -- REALISTIC MOBILE KEYBOARD -- */
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 10px; /* Satƒ±r arasƒ± bo≈üluk */
            width: 100%;
            user-select: none;
            padding: 0 2px; /* Hafif kenar payƒ± */
            margin-bottom: 10px;
        }

        .row { 
            display: flex; 
            justify-content: center; 
            gap: 5px; /* Tu≈ü arasƒ± bo≈üluk */
            width: 100%; 
        }

        /* ƒ∞≈ûTE KLAVYE D√úZENƒ∞ SIRRI BURADA */
        .row:nth-child(2) { 
            padding: 0 18px; /* 2. Satƒ±rƒ± (ASDF) i√ßeri basar */
        }

        .key {
            background-color: var(--key-bg);
            border-radius: 5px;
            height: 54px; /* Tu≈ülar daha uzun (Phone style) */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 1.3rem;
            cursor: pointer;
            position: relative;
            flex: 1;
            box-shadow: 0 1px 0 rgba(0,0,0,0.3);
            transition: transform 0.05s;
        }

        .key.space { flex: 5; font-size: 1rem; color: #999; }
        .key.special { flex: 1.3; background-color: #333; font-size: 1rem;}
        .key.enter { flex: 2; background-color: var(--accent-color); color: #121212; font-weight: 800; }
        
        /* Ghost Mode: Harfler Gizli */
        .key span { opacity: 0; }
        .key.special span, .key.enter span, .key.space span { opacity: 1; }

        /* Basƒ±nca Beyaz Olma Efekti (iPhone gibi) */
        .key.active-key { 
            background-color: var(--key-active) !important;
            color: var(--key-text-active);
            transform: scale(1.2); /* Pop-up efekti */
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            border-radius: 8px;
        }
        .key.active-key span { opacity: 1; font-weight: bold; } /* Basƒ±nca harfi g√∂ster (isteƒüe baƒülƒ±, ≈üu an kapalƒ±) */

        /* -- SCREENS -- */
        #game-screen, #result-screen { display: none; height: 100%; flex-direction: column; justify-content: space-between;}
        #start-screen, #result-screen { text-align: center; display: flex; flex-direction: column; justify-content: center; height: 100%; animation: fadeIn 0.5s ease;}

        button.cta {
            background: var(--accent-color);
            border: none;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 900;
            border-radius: 16px;
            cursor: pointer;
            margin-top: 25px;
            color: #121212;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        /* RESULT CARD */
        .result-card {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 30px;
            border: 1px solid #333;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .stat-item { display: flex; flex-direction: column; }
        .stat-val { font-size: 2.5rem; font-weight: 800; color: #fff; line-height: 1;}
        .stat-lbl { font-size: 0.8rem; color: #888; margin-top: 5px; font-weight: 600;}
        
        .wpm-highlight { color: var(--accent-color); }

        /* HYPE ANIMATIONS */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake-screen { animation: shake 0.5s; }

    </style>
</head>
<body>

    <div class="container">
        
        <!-- START SCREEN -->
        <div id="start-screen">
            <div style="font-size: 5rem; margin-bottom: 10px;">üöÄ</div>
            <h1 style="font-size: 2rem; color:#fff; line-height: 1.2;">SPEED<br><span style="color:var(--accent-color)">GHOST</span></h1>
            <p style="margin-top: 20px; color:#888; font-size: 1rem;">
                Speed + Accuracy.<br>The ultimate muscle memory test.
            </p>
            
            <div id="challenge-msg" style="display:none; background: #222; padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px solid var(--accent-color); color: #fff;"></div>

            <button class="cta">START RACE</button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                
                <div id="timer" class="timer-box">0.00</div>
                
                <div class="target-box">
                    <span id="target-text" class="target-text">...</span>
                </div>

                <div id="user-input" class="input-display">|</div>
            </div>

            <!-- MOBILE LAYOUT KEYBOARD -->
            <div class="keyboard">
                <div class="row" id="row1"></div> <!-- QWERTY -->
                <div class="row" id="row2"></div> <!-- ASDFG (Indented) -->
                <div class="row" id="row3"></div> <!-- ZXCV (Centered) -->
                <div class="row">
                    <div class="key special" id="key-123"><span>123</span></div>
                    <div class="key space" id="key-space"><span>space</span></div>
                    <div class="key enter" id="key-enter"><span>GO</span></div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen">
            <div>
                <h2 id="roast-header" style="color: var(--accent-color); text-transform: uppercase; margin-bottom: 10px;">...</h2>
                
                <div class="result-card">
                    <div class="stats-row">
                        <div class="stat-item">
                            <span class="stat-val wpm-highlight" id="res-wpm">0</span>
                            <span class="stat-lbl">WPM (Speed)</span>
                        </div>
                        <div style="width: 1px; background: #444;"></div>
                        <div class="stat-item">
                            <span class="stat-val" id="score-display">0%</span>
                            <span class="stat-lbl">Accuracy</span>
                        </div>
                    </div>
                    <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; color: #888; font-size: 0.9rem;">
                        Time: <span id="res-time" style="color:#fff">0.00s</span>
                    </div>
                </div>

                <p id="roast-msg" style="color: #ccc; font-size: 1rem; line-height: 1.4; padding: 0 20px;">...</p>

                <!-- Detailed Compare -->
                <div style="text-align:left; margin-top: 20px; background: #151515; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.85rem; opacity: 0.8;">
                    <div style="color:#666; font-size: 0.7rem; margin-bottom: 5px;">TARGET</div>
                    <div style="color:var(--accent-color); margin-bottom:10px; word-wrap: break-word;" id="res-goal"></div>
                    <div style="color:#666; font-size: 0.7rem; margin-bottom: 5px;">YOU</div>
                    <div style="color:#fff; word-wrap: break-word;" id="res-user"></div>
                </div>
            </div>

            <div>
                <button class="cta" onclick="shareResult()">CHALLENGE</button>
                <button style="background:none; border:1px solid #444; color:#888; padding: 12px 30px; border-radius: 50px; margin-top: 15px; cursor:pointer; font-size: 0.9rem; margin-bottom: 10px;" onclick="resetGame()">TRY AGAIN</button>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIG ---
        // Removed apostrophes for fair keyboard play
        const phrases = [
            "may the force be with you",
            "you shall not pass",
            "i am your father",
            "why so serious",
            "there is no spoon",
            "first rule of fight club",
            "you are a wizard harry",
            "to infinity and beyond",
            "show me the money",
            "winter is coming",
            "bond james bond",
            "i see dead people",
            "hasta la vista baby",
            "houston we have a problem",
            "here is johnny",
            "my precious",
            "et phone home",
            "just keep swimming",
            "meet me in five minutes",
            "where are we going tonight",
            "send me the location",
            "why are you ignoring me",
            "call me back right now",
            "i need coffee immediately"
        ];

        let currentPhraseIndex = -1; 
        let typedText = "";
        let startTime = 0;
        let timerInterval = null;
        let gameActive = false;

        // --- STARTUP ---
        window.addEventListener('DOMContentLoaded', () => {
            initKeyboard();
            setupSpecialKey('key-space', ' ');
            setupSpecialKey('key-enter', 'ENTER');
            setupSpecialKey('key-123', '123');

            const urlParams = new URLSearchParams(window.location.search);
            const challengeIndex = urlParams.get('p');
            const startBtn = document.querySelector('#start-screen .cta');

            if (challengeIndex !== null && phrases[challengeIndex]) {
                currentPhraseIndex = parseInt(challengeIndex);
                document.getElementById('challenge-msg').style.display = 'block';
                document.getElementById('challenge-msg').innerHTML = "‚ö†Ô∏è <strong>INCOMING RACE</strong><br>Can you type this faster?";
                startBtn.innerText = "ACCEPT RACE";
                startBtn.addEventListener('click', () => startSpecificGame(currentPhraseIndex));
            } else {
                startBtn.addEventListener('click', startGame);
            }
        });

        // --- TIMER ---
        function startTimer() {
            startTime = Date.now();
            gameActive = true;
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('timer').innerText = elapsed.toFixed(2);
            }, 30);
        }

        function stopTimer() {
            gameActive = false;
            clearInterval(timerInterval);
            return (Date.now() - startTime) / 1000;
        }

        // --- GAME ---
        function startGame() {
            const randomIndex = Math.floor(Math.random() * phrases.length);
            startSpecificGame(randomIndex);
        }

        function startSpecificGame(index) {
            currentPhraseIndex = index;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            document.getElementById('target-text').innerText = `"${phrases[index]}"`;
            typedText = "";
            updateDisplay();
            
            document.getElementById('timer').innerText = "0.00";
            startTimer();
        }

        function handleKey(key, element) {
            if(!gameActive) return;
            
            // Visual Feedback (Pop effect)
            if(element) {
                element.classList.add('active-key');
                setTimeout(() => element.classList.remove('active-key'), 100);
            }
            
            if (navigator.vibrate) try { navigator.vibrate(10); } catch(e){}

            if (key === 'BACKSPACE') {
                typedText = typedText.slice(0, -1);
            } else if (key === '123') {
                // ignore
            } else {
                typedText += key;
            }
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('user-input').innerText = typedText + "|"; 
        }

        function submitGame() {
            if(!gameActive) return;
            const timeTaken = stopTimer();
            
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';

            const target = phrases[currentPhraseIndex];
            const accuracy = calculateAccuracy(target, typedText);
            
            // WPM Calc: (Characters / 5) / Minutes
            const wpm = Math.round((typedText.length / 5) / (timeTaken / 60)) || 0;

            document.getElementById('score-display').innerText = accuracy + "%";
            document.getElementById('res-time').innerText = timeTaken.toFixed(2) + "s";
            document.getElementById('res-wpm').innerText = wpm;
            document.getElementById('res-goal').innerText = target;
            document.getElementById('res-user').innerText = typedText;

            // ROAST LOGIC
            const header = document.getElementById('roast-header');
            const msg = document.getElementById('roast-msg');
            const card = document.querySelector('.result-card');

            // Reset Animations
            document.body.classList.remove('shake-screen');
            card.style.borderColor = "#333";

            if (accuracy >= 90) {
                if (wpm > 65) {
                    header.innerText = "üî• GOD TIER üî•";
                    msg.innerText = "Are you a robot? That was insane.";
                    document.body.classList.add('shake-screen');
                    card.style.borderColor = "var(--accent-color)";
                } else if (wpm > 40) {
                    header.innerText = "RESPECT üëä";
                    msg.innerText = "Solid speed. Good accuracy. You pass.";
                } else {
                    header.innerText = "TOO SLOW üê¢";
                    msg.innerText = "Perfect accuracy, but my grandma texts faster.";
                }
            } else if (accuracy >= 60) {
                 if (wpm > 70) {
                    header.innerText = "CHAOTIC üå™";
                    msg.innerText = "You are fast, but you broke everything.";
                } else {
                    header.innerText = "MEH üòê";
                    msg.innerText = "You need to practice more.";
                }
            } else {
                header.innerText = "DISASTER üíÄ";
                msg.innerText = "Did you type this with your elbows?";
                card.style.borderColor = "var(--wrong-color)";
            }
        }

        function resetGame() {
            window.history.pushState({}, document.title, window.location.pathname);
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('challenge-msg').style.display = 'none';
            
            const startBtn = document.querySelector('#start-screen .cta');
            const newBtn = startBtn.cloneNode(true);
            startBtn.parentNode.replaceChild(newBtn, startBtn);
            newBtn.innerText = "START RACE";
            newBtn.addEventListener('click', startGame);
        }

        // --- KEYBOARD SETUP ---
        function initKeyboard() {
            const row1Keys = "qwertyuiop".split("");
            const row2Keys = "asdfghjkl".split("");
            const row3Keys = "zxcvbnm".split("");
            
            renderRow('row1', row1Keys);
            renderRow('row2', row2Keys);
            
            const r3 = document.getElementById('row3');
            r3.innerHTML = ''; 
            
            let shift = document.createElement('div');
            shift.className = 'key special';
            shift.innerHTML = '<span>‚¨Ü</span>'; 
            r3.appendChild(shift);
            
            row3Keys.forEach(char => createKey(r3, char));
            
            let back = document.createElement('div');
            back.className = 'key special';
            back.innerHTML = '<span>‚å´</span>';
            back.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey('BACKSPACE', back); });
            back.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey('BACKSPACE', back); });
            r3.appendChild(back);
        }

        function renderRow(id, keys) {
            const row = document.getElementById(id);
            row.innerHTML = '';
            keys.forEach(char => createKey(row, char));
        }

        function createKey(parent, char) {
            let k = document.createElement('div');
            k.className = 'key';
            k.innerHTML = `<span>${char.toUpperCase()}</span>`;
            // Pass element 'k' to handleKey for visual feedback
            k.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey(char, k); });
            k.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey(char, k); });
            parent.appendChild(k);
        }

        function setupSpecialKey(id, action) {
            const el = document.getElementById(id);
            if(!el) return;
            const handler = (e) => {
                e.preventDefault(); 
                if(action === 'ENTER') submitGame();
                else handleKey(action, el);
            };
            el.addEventListener('touchstart', handler);
            el.addEventListener('mousedown', handler);
        }

        // --- MATH ---
        function calculateAccuracy(target, attempt) {
            if (!attempt) return 0;
            target = target.toLowerCase();
            attempt = attempt.toLowerCase();
            const distance = levenshtein(target, attempt);
            const maxLength = Math.max(target.length, attempt.length);
            let accuracy = ((maxLength - distance) / maxLength) * 100;
            return Math.max(0, Math.floor(accuracy));
        }

        function levenshtein(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        // --- SHARE ---
        async function shareResult() {
            const acc = document.getElementById('score-display').innerText;
            const time = document.getElementById('res-time').innerText;
            const wpm = document.getElementById('res-wpm').innerText;
            
            const currentUrl = window.location.href.split('?')[0]; 
            const challengeLink = `${currentUrl}?p=${currentPhraseIndex}`;
            
            const shareData = {
                title: 'Ghost Speed Race',
                text: `‚ö°Ô∏è I hit ${wpm} WPM with ${acc} accuracy on the Ghost Keyboard.\n\nCan you beat me?\n`,
                url: challengeLink
            };

            if (navigator.share) {
                try { await navigator.share(shareData); } catch (err) {}
            } else {
                const textToCopy = `${shareData.text} ${challengeLink}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const btn = document.querySelector('#result-screen .cta');
                    const originalText = btn.innerText;
                    btn.innerText = "COPIED!";
                    setTimeout(() => { btn.innerText = originalText; }, 2000);
                });
            }
        }
    </script>
</body>
</html>
