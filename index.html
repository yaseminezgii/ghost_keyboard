<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost Keyboard</title>
    
    <meta property="og:title" content="Ghost Keyboard Challenge">
    <meta property="og:description" content="Invisible keys. Can you type blindly?">

    <style>
        :root {
            --bg-color: #121212;
            --text-color: #ffffff;
            --accent-color: #00ff88; 
            --key-bg: #4a4a4c;
            --key-active: #ffffff;
            --key-text-active: #000000;
            --wrong-color: #ff4444;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100dvh; 
            margin: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            padding-bottom: calc(5px + env(safe-area-inset-bottom)); 
            position: relative;
        }

        /* -- START SCREEN -- */
        .logo { font-size: 4.5rem; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .tutorial-box {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid #333;
        }
        .tut-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #ccc;
        }
        .tut-icon { margin-right: 10px; font-size: 1.2rem; }
        .tut-item:last-child { margin-bottom: 0; }

        /* -- HUD -- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            margin-bottom: 10px;
        }

        .timer-box {
            font-size: 0.9rem; /* K√º√ß√ºlt√ºld√º */
            font-weight: 400;
            color: #444; /* Silikle≈ütirildi */
            font-variant-numeric: tabular-nums;
        }

        .target-box {
            background: rgba(30,30,30, 0.8);
            padding: 20px;
            border-radius: 18px;
            text-align: center;
            margin: 5px 0 15px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .target-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color);
            line-height: 1.4;
        }

        .input-display {
            font-size: 1.4rem;
            min-height: 40px;
            border-bottom: 2px solid #444;
            margin-bottom: 20px;
            text-align: center;
            white-space: pre; 
            color: #fff;
            font-family: monospace;
            letter-spacing: 1px;
        }

        /* -- KEYBOARD -- */
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            user-select: none;
            padding: 0 2px;
            margin-bottom: 10px;
        }

        .row { display: flex; justify-content: center; gap: 5px; width: 100%; }
        .row:nth-child(2) { padding: 0 18px; }

        .key {
            background-color: var(--key-bg);
            border-radius: 6px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 1.3rem;
            cursor: pointer;
            position: relative;
            flex: 1;
            box-shadow: 0 1px 0 rgba(0,0,0,0.3);
            transition: transform 0.05s;
        }

        .key.space { flex: 5; font-size: 1rem; color: #999; }
        .key.special { flex: 1.3; background-color: #333; font-size: 1rem;}
        .key.enter { flex: 2; background-color: var(--accent-color); color: #121212; font-weight: 800; }
        
        .key span { opacity: 0; }
        .key.special span, .key.enter span, .key.space span { opacity: 1; }

        .key.active-key { 
            background-color: var(--key-active) !important;
            color: var(--key-text-active);
            transform: scale(1.15);
            z-index: 10;
            border-radius: 8px;
        }

        /* -- SCREENS -- */
        #game-screen, #result-screen { display: none; height: 100%; flex-direction: column; justify-content: space-between;}
        #start-screen, #result-screen { text-align: center; display: flex; flex-direction: column; justify-content: center; height: 100%; animation: fadeIn 0.5s ease;}

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        button.cta {
            background: var(--accent-color);
            border: none;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 16px;
            cursor: pointer;
            margin-top: 25px;
            color: #121212;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        /* RESULT CARD */
        .result-card {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 25px;
            border: 1px solid #333;
            margin-bottom: 20px;
            position: relative;
        }
        
        .stats-row { display: flex; justify-content: space-around; margin-top: 10px; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-val { font-size: 2.5rem; font-weight: 800; color: #fff; line-height: 1;}
        .stat-lbl { font-size: 0.8rem; color: #888; margin-top: 5px; font-weight: 600;}
        .wpm-highlight { color: var(--accent-color); }

        /* Roast Message */
        #roast-msg {
            font-size: 1.1rem;
            line-height: 1.4;
            color: #eee;
            padding: 10px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body>

    <div class="container">
        
        <!-- START SCREEN -->
        <div id="start-screen">
            <div class="logo">üëª</div>
            <h1 style="font-size: 2.5rem; color:#fff; line-height: 1;">GHOST<br><span style="color:var(--accent-color)">KEYBOARD</span></h1>
            
            <!-- NEW: HOW TO PLAY SECTION -->
            <div class="tutorial-box">
                <div class="tut-item">
                    <span class="tut-icon">üëÄ</span>
                    <span>Read the phrase at the top.</span>
                </div>
                <div class="tut-item">
                    <span class="tut-icon">‚å®Ô∏è</span>
                    <span>Type it blindly (keys are invisible).</span>
                </div>
                <div class="tut-item">
                    <span class="tut-icon">üß†</span>
                    <span>Trust your muscle memory!</span>
                </div>
            </div>
            
            <div id="challenge-msg" style="display:none; background: #222; padding: 10px; border-radius: 8px; margin-top: 15px; border: 1px solid var(--accent-color); color: #fff;"></div>

            <button class="cta">START</button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                
                <!-- Subtle Timer -->
                <div class="top-bar">
                    <span style="font-size:0.8rem; color:#444;">GHOST MODE</span>
                    <div id="timer" class="timer-box">0.0s</div>
                </div>
                
                <div class="target-box">
                    <span id="target-text" class="target-text">Loading...</span>
                </div>

                <div id="user-input" class="input-display">|</div>
            </div>

            <!-- KEYBOARD -->
            <div class="keyboard">
                <div class="row" id="row1"></div> 
                <div class="row" id="row2"></div> 
                <div class="row" id="row3"></div> 
                <div class="row">
                    <div class="key special" id="key-123"><span>123</span></div>
                    <div class="key space" id="key-space"><span>space</span></div>
                    <div class="key enter" id="key-enter"><span>GO</span></div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen">
            <div>
                <h2 id="roast-header" style="color: var(--accent-color); text-transform: uppercase; margin-bottom: 5px; font-size: 1.5rem;">RESULT</h2>
                
                <div class="result-card">
                    <div class="stats-row">
                        <div class="stat-item">
                            <span class="stat-val wpm-highlight" id="res-wpm">0</span>
                            <span class="stat-lbl">WPM</span>
                        </div>
                        <div style="width: 1px; background: #444;"></div>
                        <div class="stat-item">
                            <span class="stat-val" id="score-display">0%</span>
                            <span class="stat-lbl">ACCURACY</span>
                        </div>
                    </div>
                </div>

                <p id="roast-msg">...</p>

                <div style="text-align:left; margin-top: 15px; background: #151515; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.8rem; opacity: 0.8;">
                    <div style="color:#666; font-size: 0.7rem; margin-bottom: 5px;">GOAL</div>
                    <div style="color:var(--accent-color); margin-bottom:10px; word-wrap: break-word;" id="res-goal"></div>
                    <div style="color:#666; font-size: 0.7rem; margin-bottom: 5px;">YOU</div>
                    <div style="color:#fff; word-wrap: break-word;" id="res-user"></div>
                </div>
            </div>

            <div>
                <button class="cta" onclick="shareResult()">CHALLENGE FRIENDS</button>
                <button style="background:none; border:1px solid #444; color:#888; padding: 12px 30px; border-radius: 50px; margin-top: 15px; cursor:pointer; font-size: 0.9rem; margin-bottom: 10px;" onclick="resetGame()">TRY AGAIN</button>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIG ---
        const phrases = [
            "may the force be with you",
            "you shall not pass",
            "i am your father",
            "why so serious",
            "there is no spoon",
            "first rule of fight club",
            "you are a wizard harry",
            "to infinity and beyond",
            "show me the money",
            "winter is coming",
            "bond james bond",
            "i see dead people",
            "hasta la vista baby",
            "houston we have a problem",
            "here is johnny",
            "my precious",
            "et phone home",
            "just keep swimming",
            "meet me in five minutes",
            "where are we going tonight",
            "send me the location",
            "why are you ignoring me",
            "call me back right now",
            "i need coffee immediately"
        ];

        let currentPhraseIndex = -1; 
        let typedText = "";
        let startTime = 0;
        let timerInterval = null;
        let gameActive = false;

        // --- STARTUP ---
        window.addEventListener('DOMContentLoaded', () => {
            initKeyboard();
            setupSpecialKey('key-space', ' ');
            setupSpecialKey('key-enter', 'ENTER');
            setupSpecialKey('key-123', '123');

            const urlParams = new URLSearchParams(window.location.search);
            const challengeIndex = urlParams.get('p');
            const startBtn = document.querySelector('#start-screen .cta');

            if (challengeIndex !== null && phrases[challengeIndex]) {
                currentPhraseIndex = parseInt(challengeIndex);
                document.getElementById('challenge-msg').style.display = 'block';
                document.getElementById('challenge-msg').innerHTML = "‚ö†Ô∏è <strong>RACE MODE</strong><br>Beat this score.";
                startBtn.innerText = "ACCEPT";
                startBtn.addEventListener('click', () => startSpecificGame(currentPhraseIndex));
            } else {
                startBtn.addEventListener('click', startGame);
            }
        });

        // --- TIMER ---
        function startTimer() {
            startTime = Date.now();
            gameActive = true;
            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('timer').innerText = elapsed.toFixed(1) + "s";
            }, 100);
        }

        function stopTimer() {
            gameActive = false;
            clearInterval(timerInterval);
            return (Date.now() - startTime) / 1000;
        }

        // --- GAME ---
        function startGame() {
            const randomIndex = Math.floor(Math.random() * phrases.length);
            startSpecificGame(randomIndex);
        }

        function startSpecificGame(index) {
            currentPhraseIndex = index;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            document.getElementById('target-text').innerText = `"${phrases[index]}"`;
            typedText = "";
            updateDisplay();
            
            document.getElementById('timer').innerText = "0.0s";
            startTimer();
        }

        function handleKey(key, element) {
            if(!gameActive) return;
            
            if(element) {
                element.classList.add('active-key');
                setTimeout(() => element.classList.remove('active-key'), 100);
            }
            
            if (navigator.vibrate) try { navigator.vibrate(10); } catch(e){}

            if (key === 'BACKSPACE') {
                typedText = typedText.slice(0, -1);
            } else if (key === '123') {
                // ignore
            } else {
                typedText += key;
            }
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('user-input').innerText = typedText + "|"; 
        }

        function submitGame() {
            if(!gameActive) return;
            const timeTaken = stopTimer();
            
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';

            const target = phrases[currentPhraseIndex];
            const accuracy = calculateAccuracy(target, typedText);
            const wpm = Math.round((typedText.length / 5) / (timeTaken / 60)) || 0;

            document.getElementById('score-display').innerText = accuracy + "%";
            document.getElementById('res-wpm').innerText = wpm;
            document.getElementById('res-goal').innerText = target;
            document.getElementById('res-user').innerText = typedText;

            // --- FUNNY & EMOJI RICH ROASTS ---
            const header = document.getElementById('roast-header');
            const msg = document.getElementById('roast-msg');
            const card = document.querySelector('.result-card');
            card.style.borderColor = "#333"; // reset

            if (accuracy === 100) {
                if (wpm > 60) {
                    header.innerText = "üî• GOD MODE üî•";
                    msg.innerText = "Are you a robot? Or did you cheat? ü§ñüëÄ";
                    card.style.borderColor = "var(--accent-color)";
                } else if (wpm > 30) {
                    header.innerText = "CLEAN ‚ú®";
                    msg.innerText = "Slow and steady wins the race. Respect. üëä";
                } else {
                    header.innerText = "GRANDMA? üëµ";
                    msg.innerText = "Perfect typing... but I fell asleep waiting. üí§";
                }
            } else if (accuracy >= 80) {
                if (wpm > 60) {
                    header.innerText = "CHAOTIC GOOD ‚ö°Ô∏è";
                    msg.innerText = "Fast as hell, but slightly drunk. üçª";
                } else {
                    header.innerText = "NOT BAD üëç";
                    msg.innerText = "You pass. But you can do better. üìâ";
                }
            } else if (accuracy >= 50) {
                 header.innerText = "FAT FINGERS? üå≠";
                 msg.innerText = "Are you typing with your elbows? üíÄ";
            } else {
                header.innerText = "DISASTER ü§°";
                msg.innerText = "Close your eyes... oh wait, they were already closed. ü´£";
                card.style.borderColor = "var(--wrong-color)";
            }
        }

        function resetGame() {
            window.history.pushState({}, document.title, window.location.pathname);
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('challenge-msg').style.display = 'none';
            
            const startBtn = document.querySelector('#start-screen .cta');
            const newBtn = startBtn.cloneNode(true);
            startBtn.parentNode.replaceChild(newBtn, startBtn);
            newBtn.innerText = "START";
            newBtn.addEventListener('click', startGame);
        }

        // --- KEYBOARD ---
        function initKeyboard() {
            const row1Keys = "qwertyuiop".split("");
            const row2Keys = "asdfghjkl".split("");
            const row3Keys = "zxcvbnm".split("");
            renderRow('row1', row1Keys);
            renderRow('row2', row2Keys);
            const r3 = document.getElementById('row3');
            r3.innerHTML = ''; 
            let shift = document.createElement('div');
            shift.className = 'key special';
            shift.innerHTML = '<span>‚¨Ü</span>'; 
            r3.appendChild(shift);
            row3Keys.forEach(char => createKey(r3, char));
            let back = document.createElement('div');
            back.className = 'key special';
            back.innerHTML = '<span>‚å´</span>';
            back.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey('BACKSPACE', back); });
            back.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey('BACKSPACE', back); });
            r3.appendChild(back);
        }
        function renderRow(id, keys) {
            const row = document.getElementById(id);
            row.innerHTML = '';
            keys.forEach(char => createKey(row, char));
        }
        function createKey(parent, char) {
            let k = document.createElement('div');
            k.className = 'key';
            k.innerHTML = `<span>${char.toUpperCase()}</span>`;
            k.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey(char, k); });
            k.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey(char, k); });
            parent.appendChild(k);
        }
        function setupSpecialKey(id, action) {
            const el = document.getElementById(id);
            if(!el) return;
            const handler = (e) => {
                e.preventDefault(); 
                if(action === 'ENTER') submitGame();
                else handleKey(action, el);
            };
            el.addEventListener('touchstart', handler);
            el.addEventListener('mousedown', handler);
        }

        // --- ALGORITHMS & SHARE ---
        function calculateAccuracy(target, attempt) {
            if (!attempt) return 0;
            target = target.toLowerCase();
            attempt = attempt.toLowerCase();
            const distance = levenshtein(target, attempt);
            const maxLength = Math.max(target.length, attempt.length);
            let accuracy = ((maxLength - distance) / maxLength) * 100;
            return Math.max(0, Math.floor(accuracy));
        }
        function levenshtein(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        }
        async function shareResult() {
            const acc = document.getElementById('score-display').innerText;
            const wpm = document.getElementById('res-wpm').innerText;
            const currentUrl = window.location.href.split('?')[0]; 
            const challengeLink = `${currentUrl}?p=${currentPhraseIndex}`;
            const shareData = {
                title: 'Ghost Keyboard',
                text: `üëª I typed invisible: ${acc} accuracy, ${wpm} WPM.\nCan you beat me?\n`,
                url: challengeLink
            };
            if (navigator.share) {
                try { await navigator.share(shareData); } catch (err) {}
            } else {
                const textToCopy = `${shareData.text} ${challengeLink}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const btn = document.querySelector('#result-screen .cta');
                    btn.innerText = "COPIED!";
                    setTimeout(() => { btn.innerText = "CHALLENGE FRIENDS"; }, 2000);
                });
            }
        }
    </script>
</body>
</html>
