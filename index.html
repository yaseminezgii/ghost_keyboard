<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost Keyboard Race</title>
    
    <meta property="og:title" content="Ghost Keyboard Challenge">
    <meta property="og:description" content="I bet you can't type on an invisible keyboard.">

    <style>
        :root {
            /* CYBERPUNK GREEN THEME */
            --bg-color: #121212;
            --text-color: #ffffff;
            --accent-color: #00ff88; 
            --key-bg: #3a3a3c;
            --key-active: #5e5e60;
            --wrong-color: #ff4444;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Ä°ÅžTE DÃœZELTME: 100vh yerine 100dvh (Dynamic Viewport Height) */
            height: 100dvh; 
            margin: 0;
            overflow: hidden; /* KaydÄ±rmayÄ± engelle */
            touch-action: none; /* Zoom ve kaydÄ±rmayÄ± engelle */
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            /* iPhone Alttaki Ã‡izgi (Home Bar) iÃ§in boÅŸluk bÄ±rakÄ±r */
            padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
            position: relative;
        }

        h1 { 
            font-size: 1.1rem; 
            opacity: 0.7; 
            margin: 0; 
            letter-spacing: 1px; 
            text-transform: uppercase;
            text-align: center;
        }
        
        /* -- GAME UI -- */
        .target-box {
            background: rgba(255,255,255,0.08);
            padding: 15px;
            border-radius: 16px;
            text-align: center;
            margin: 10px 0;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 255, 136, 0.1);
        }
        
        .target-text {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-color);
            line-height: 1.3;
        }

        .input-display {
            font-size: 1.4rem;
            min-height: 40px;
            border-bottom: 2px solid #333;
            margin-bottom: 10px;
            text-align: center;
            white-space: pre; 
            color: #fff;
            font-family: monospace;
        }

        /* -- THE GHOST KEYBOARD -- */
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 6px; /* TuÅŸ aralarÄ±nÄ± biraz kÄ±stÄ±m */
            width: 100%;
            user-select: none;
            margin-bottom: 10px;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 4px; /* Yatay boÅŸluklarÄ± azalttÄ±m */
            width: 100%;
        }

        .key {
            background-color: var(--key-bg);
            border-radius: 5px;
            height: 48px; /* TuÅŸ yÃ¼ksekliÄŸini mobil iÃ§in optimize ettim */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.05s, background-color 0.1s;
            position: relative;
            flex: 1; /* TuÅŸlarÄ±n ekrana yayÄ±lmasÄ±nÄ± saÄŸlar */
        }

        /* Key Widths - Flex ile otomatik ayarlansÄ±n ama oran korunsun */
        .row:nth-child(2) { margin: 0 15px; } /* Orta satÄ±rÄ± ortala */
        
        .key.space { flex: 5; } /* Space tuÅŸu geniÅŸ */
        .key.special { flex: 1.5; background-color: #555; font-size: 0.9rem;}
        .key.enter { flex: 2; background-color: var(--accent-color); color: #000; }

        .key span { opacity: 0; }
        .key.special span, .key.enter span { opacity: 1; }

        .key:active {
            transform: scale(0.90);
            background-color: var(--key-active);
        }

        /* -- SCREENS -- */
        #game-screen, #result-screen { display: none; height: 100%; flex-direction: column; justify-content: space-between;}
        
        #start-screen, #result-screen { 
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            height: 100%;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        button.cta {
            background: var(--accent-color);
            border: none;
            padding: 16px 32px;
            font-size: 1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            color: #121212;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        /* KÃœÃ‡ÃœK EKRANLAR Ä°Ã‡Ä°N Ã–ZEL AYAR (iPhone Mini / SE / 13) */
        @media (max-height: 700px) {
            .key { height: 42px; } /* TuÅŸlarÄ± biraz kÄ±salt */
            .target-box { min-height: 50px; padding: 10px; }
            h1 { font-size: 1rem; }
            .score-circle { width: 100px; height: 100px; font-size: 2rem; }
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 6px solid var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-color);
            margin: 0 auto 15px auto;
        }
        
        .comparison {
            text-align: left;
            background: #222;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 0.85rem;
            border: 1px solid #333;
        }
        .comp-row { margin: 5px 0; display: flex; flex-direction: column;}
        .label { color: #666; font-size: 0.6rem; text-transform: uppercase; margin-bottom: 4px;}

    </style>
</head>
<body>

    <div class="container">
        
        <!-- START SCREEN -->
        <div id="start-screen">
            <div style="font-size: 4rem; margin-bottom: 10px;">ðŸ‘»</div>
            <h1 style="font-size: 2.5rem; color:var(--accent-color); line-height: 1;">GHOST<br>KEYBOARD</h1>
            <p style="margin-top: 15px; font-size: 1rem;">The keys are invisible.<br>Muscle memory only.</p>
            
            <div id="challenge-msg" style="display:none; background: #333; padding: 10px; border-radius: 8px; margin-top: 15px; color: var(--accent-color); font-size: 0.9rem;"></div>

            <button class="cta">START</button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen">
            <!-- Ãœst KÄ±sÄ±m -->
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <header>
                    <h1 id="mode-title">Ghost Mode</h1>
                </header>

                <div class="target-box">
                    <span id="target-text" class="target-text">Loading...</span>
                </div>

                <div id="user-input" class="input-display">|</div>
            </div>

            <!-- Alt KÄ±sÄ±m: Klavye (En alta yapÄ±ÅŸÄ±k) -->
            <div class="keyboard">
                <div class="row" id="row1"></div>
                <div class="row" id="row2"></div>
                <div class="row" id="row3"></div>
                <div class="row">
                    <div class="key special" id="key-123"><span>123</span></div>
                    <div class="key space" id="key-space"><span>space</span></div>
                    <div class="key enter" id="key-enter"><span>GO</span></div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen">
            <div>
                <h1>ACCURACY</h1>
                <div class="score-circle" id="score-display">0%</div>
                <p id="roast-msg" style="font-style: italic; color: #aaa; margin: 0 0 15px 0; min-height: 20px; font-size: 0.9rem;">...</p>

                <div class="comparison">
                    <div class="comp-row">
                        <span class="label">GOAL</span>
                        <span id="res-goal" style="color: var(--accent-color)"></span>
                    </div>
                    <div class="comp-row" style="border-top: 1px solid #444; padding-top: 8px;">
                        <span class="label">YOU TYPED</span>
                        <span id="res-user" style="color: #fff"></span>
                    </div>
                </div>
            </div>

            <div>
                <button class="cta" onclick="shareResult()">CHALLENGE FRIENDS</button>
                <button style="background:none; border:1px solid #555; color:#888; padding: 10px 25px; border-radius: 50px; margin-top: 10px; cursor:pointer; font-size: 0.8rem; margin-bottom: 10px;" onclick="resetGame()">TRY AGAIN</button>
            </div>
        </div>

    </div>

    <script>
        // --- MOBILE ERROR HANDLING ---
        window.onerror = function(msg, url, line) {
            // alert("Error: " + msg); // Uncomment if debugging needed
        };

        // --- PHRASES ---
        const phrases = [
            "may the force be with you",
            "you shall not pass",
            "i am your father",
            "why so serious",
            "there is no spoon",
            "first rule of fight club",
            "you are a wizard harry",
            "one does not simply walk into mordor",
            "to infinity and beyond",
            "show me the money",
            "winter is coming",
            "bond james bond",
            "i see dead people",
            "life is like a box of chocolates",
            "hasta la vista baby",
            "houston we have a problem",
            "here is johnny",
            "my precious",
            "keep your friends close",
            "et phone home",
            "just keep swimming",
            "elementary my dear watson",
            "say hello to my little friend",
            "do not go gentle into that good night",
            "meet me in five minutes",
            "did you see that email",
            "can you pick up pizza",
            "my battery is at one percent",
            "where are we going tonight",
            "wait i am on my way",
            "send me the location",
            "why are you ignoring me"
        ];

        let currentPhraseIndex = -1; 
        let typedText = "";

        // --- STARTUP ---
        window.addEventListener('DOMContentLoaded', () => {
            initKeyboard();
            setupSpecialKey('key-space', ' ');
            setupSpecialKey('key-enter', 'ENTER');
            setupSpecialKey('key-123', '123');

            const urlParams = new URLSearchParams(window.location.search);
            const challengeIndex = urlParams.get('p');
            const startBtn = document.querySelector('#start-screen .cta');

            if (challengeIndex !== null && phrases[challengeIndex]) {
                currentPhraseIndex = parseInt(challengeIndex);
                document.getElementById('challenge-msg').style.display = 'block';
                document.getElementById('challenge-msg').innerText = "âš ï¸ CHALLENGE RECEIVED: Beat this score.";
                startBtn.innerText = "ACCEPT CHALLENGE";
                startBtn.addEventListener('click', () => startSpecificGame(currentPhraseIndex));
            } else {
                startBtn.addEventListener('click', startGame);
            }
        });

        // --- KEYBOARD ---
        function initKeyboard() {
            const row1Keys = "qwertyuiop".split("");
            const row2Keys = "asdfghjkl".split("");
            const row3Keys = "zxcvbnm".split("");

            renderRow('row1', row1Keys);
            renderRow('row2', row2Keys);
            
            const r3 = document.getElementById('row3');
            r3.innerHTML = ''; 

            let shift = document.createElement('div');
            shift.className = 'key special';
            shift.innerHTML = '<span>â¬†</span>'; 
            r3.appendChild(shift);

            row3Keys.forEach(char => createKey(r3, char));

            let back = document.createElement('div');
            back.className = 'key special';
            back.innerHTML = '<span>âŒ«</span>';
            back.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey('BACKSPACE'); });
            back.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey('BACKSPACE'); });
            r3.appendChild(back);
        }

        function renderRow(id, keys) {
            const row = document.getElementById(id);
            row.innerHTML = '';
            keys.forEach(char => createKey(row, char));
        }

        function createKey(parent, char) {
            let k = document.createElement('div');
            k.className = 'key';
            k.innerHTML = `<span>${char.toUpperCase()}</span>`;
            k.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey(char); });
            k.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey(char); });
            parent.appendChild(k);
        }

        function setupSpecialKey(id, action) {
            const el = document.getElementById(id);
            if(!el) return;
            const handler = (e) => {
                e.preventDefault(); 
                if(action === 'ENTER') submitGame();
                else handleKey(action);
            };
            el.addEventListener('touchstart', handler);
            el.addEventListener('mousedown', handler);
        }

        // --- GAME LOGIC ---
        function startGame() {
            const randomIndex = Math.floor(Math.random() * phrases.length);
            startSpecificGame(randomIndex);
        }

        function startSpecificGame(index) {
            currentPhraseIndex = index;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            const urlParams = new URLSearchParams(window.location.search);
            if(urlParams.get('p')) {
                document.getElementById('mode-title').innerText = "VS MODE";
                document.getElementById('mode-title').style.color = "#ff4444";
            } else {
                document.getElementById('mode-title').innerText = "GHOST MODE";
                document.getElementById('mode-title').style.color = "#fff";
            }

            document.getElementById('target-text').innerText = `"${phrases[index]}"`;
            typedText = "";
            updateDisplay();
        }

        function handleKey(key) {
            if (navigator.vibrate) try { navigator.vibrate(5); } catch(e){}

            if (key === 'BACKSPACE') {
                typedText = typedText.slice(0, -1);
            } else if (key === '123') {
                // ignore
            } else {
                typedText += key;
            }
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('user-input').innerText = typedText + "|"; 
        }

        function submitGame() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';

            const target = phrases[currentPhraseIndex];
            const score = calculateScore(target, typedText);
            
            document.getElementById('score-display').innerText = score + "%";
            document.getElementById('res-goal').innerText = target;
            document.getElementById('res-user').innerText = typedText;

            let roast = "";
            if(score === 100) roast = "ðŸ¤– PERFECT.";
            else if(score > 90) roast = "ðŸ”¥ INSANE.";
            else if(score > 75) roast = "Not bad.";
            else if(score > 50) roast = "My grandma is faster.";
            else roast = "ðŸ’€ Eyes closed?";
            
            document.getElementById('roast-msg').innerText = roast;
        }

        function resetGame() {
            window.history.pushState({}, document.title, window.location.pathname);
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('challenge-msg').style.display = 'none';
            
            const startBtn = document.querySelector('#start-screen .cta');
            const newBtn = startBtn.cloneNode(true);
            startBtn.parentNode.replaceChild(newBtn, startBtn);
            newBtn.innerText = "START";
            newBtn.addEventListener('click', startGame);
        }

        // --- ALGORITHMS & SHARE ---
        function calculateScore(target, attempt) {
            if (!attempt) return 0;
            target = target.toLowerCase();
            attempt = attempt.toLowerCase();
            const distance = levenshtein(target, attempt);
            const maxLength = Math.max(target.length, attempt.length);
            let accuracy = ((maxLength - distance) / maxLength) * 100;
            return Math.max(0, Math.floor(accuracy));
        }

        function levenshtein(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        async function shareResult() {
            const score = document.getElementById('score-display').innerText;
            const currentUrl = window.location.href.split('?')[0]; 
            const challengeLink = `${currentUrl}?p=${currentPhraseIndex}`;
            const shareData = {
                title: 'Ghost Keyboard',
                text: `ðŸ‘» I got ${score} accuracy on the invisible keyboard.\nCan you beat me?\n`,
                url: challengeLink
            };

            if (navigator.share) {
                try { await navigator.share(shareData); } catch (err) {}
            } else {
                const textToCopy = `${shareData.text} ${challengeLink}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const btn = document.querySelector('#result-screen .cta');
                    const originalText = btn.innerText;
                    btn.innerText = "LINK COPIED! âœ…";
                    setTimeout(() => { btn.innerText = originalText; }, 2000);
                });
            }
        }
    </script>
</body>
</html>
