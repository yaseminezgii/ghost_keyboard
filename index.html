<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost Cinema: Movie Edition</title>
    
    <!-- Social Sharing Info -->
    <meta property="og:title" content="Ghost Cinema Challenge">
    <meta property="og:description" content="Can you type these famous movie quotes on an invisible keyboard?">
    
    <style>
        :root {
            --bg-color: #0f0f13;
            --text-color: #ffffff;
            --accent-color: #ffd700; /* Gold */
            --key-bg: #2c2c2e;
            --key-active: #48484a;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation; /* Improves touch response */
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        h1 { 
            font-size: 1.2rem; 
            opacity: 0.8; 
            margin: 0; 
            letter-spacing: 2px; 
            text-transform: uppercase;
            text-align: center;
            font-weight: 800;
        }
        
        /* -- GAME UI -- */
        .target-box {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin: 20px 0;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,215,0, 0.1);
        }
        
        .target-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-color);
            line-height: 1.4;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .input-display {
            font-size: 1.5rem;
            min-height: 40px;
            border-bottom: 2px solid #333;
            margin-bottom: 20px;
            text-align: center;
            white-space: pre; 
            color: #fff;
            font-family: monospace;
        }

        /* -- THE GHOST KEYBOARD -- */
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-bottom: 30px;
            user-select: none;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 6px;
        }

        .key {
            background-color: var(--key-bg);
            border-radius: 6px;
            height: 52px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.05s, background-color 0.1s;
            box-shadow: 0 3px 0 rgba(0,0,0,0.4);
            position: relative; /* For span positioning */
        }

        .row:nth-child(1) .key { width: 9%; } 
        .row:nth-child(2) .key { width: 9%; } 
        .row:nth-child(3) .key { width: 13%; } 
        
        .key.space { width: 50%; }
        .key.special { width: 15%; background-color: #444; font-size: 0.9rem;}
        .key.enter { background-color: var(--accent-color); color: #000; }

        /* THE GHOST EFFECT: Opacity 0 makes letters invisible */
        .key span { opacity: 0; }
        .key.special span, .key.enter span { opacity: 1; }

        .key:active {
            transform: scale(0.90) translateY(3px);
            background-color: var(--key-active);
            box-shadow: none;
        }

        /* -- SCREENS -- */
        #game-screen, #result-screen { display: none; height: 100%; flex-direction: column; justify-content: space-between;}
        
        #start-screen, #result-screen { 
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            height: 100%;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        button.cta {
            background: var(--accent-color);
            border: none;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 25px;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            transition: transform 0.1s;
        }
        button.cta:active { transform: scale(0.95); }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 6px solid var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-color);
            margin: 0 auto 20px auto;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1) inset;
        }
        
        .comparison {
            text-align: left;
            background: #222;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9rem;
            border: 1px solid #333;
        }
        .comp-row { margin: 8px 0; display: flex; flex-direction: column;}
        .label { color: #666; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 4px;}

    </style>
</head>
<body>

    <div class="container">
        
        <!-- START SCREEN -->
        <div id="start-screen">
            <div style="font-size: 4rem; margin-bottom: 10px;">ðŸŽ¬</div>
            <h1 style="font-size: 2.5rem; color:var(--accent-color); line-height: 1;">GHOST<br>CINEMA</h1>
            <p style="margin-top: 20px; font-size: 1.1rem; color: #ccc;">Famous quotes.<br>Invisible keys.</p>
            
            <div id="challenge-msg" style="display:none; background: #222; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--accent-color);">
                <!-- Challenge text injected via JS -->
            </div>

            <!-- Notice: No onclick here. JS handles it. -->
            <button class="cta">START SCENE</button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen">
            <div>
                <header>
                    <h1 id="mode-title">Movie Quotes</h1>
                </header>

                <div class="target-box">
                    <span id="target-text" class="target-text">Loading...</span>
                </div>

                <div id="user-input" class="input-display">|</div>
            </div>

            <!-- The Virtual Keyboard -->
            <div class="keyboard">
                <div class="row" id="row1"></div>
                <div class="row" id="row2"></div>
                <div class="row" id="row3"></div>
                <div class="row">
                    <div class="key special" id="key-123"><span>123</span></div>
                    <div class="key space" id="key-space"><span>space</span></div>
                    <div class="key enter" id="key-enter"><span>CUT</span></div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen">
            <h1 style="margin-bottom: 20px;">ACCURACY</h1>
            <div class="score-circle" id="score-display">0%</div>
            
            <p id="roast-msg" style="font-style: italic; color: #aaa; margin: 0 0 20px 0; min-height: 20px;">...</p>

            <div class="comparison">
                <div class="comp-row">
                    <span class="label">SCRIPT SAYS:</span>
                    <span id="res-goal" style="color: var(--accent-color)"></span>
                </div>
                <div class="comp-row" style="border-top: 1px solid #444; padding-top: 8px;">
                    <span class="label">YOU IMPROVISED:</span>
                    <span id="res-user" style="color: #fff"></span>
                </div>
            </div>

            <button class="cta" onclick="shareResult()">CHALLENGE FRIENDS</button>
            <button style="background:none; border:1px solid #555; color:#888; padding: 12px 25px; border-radius: 50px; margin-top: 15px; cursor:pointer; font-size: 0.9rem;" onclick="resetGame()">NEXT SCENE</button>
        </div>

    </div>

    <script>
        // --- 1. ERROR TRAP (Shows alerts if code breaks on mobile) ---
        window.onerror = function(msg, url, line) {
            alert("Error: " + msg + "\nLine: " + line);
        };

        // --- 2. CONFIGURATION ---
        const phrases = [
            "may the force be with you",
            "you shall not pass",
            "i am your father",
            "why so serious",
            "there is no spoon",
            "first rule of fight club",
            "you are a wizard harry",
            "one does not simply walk into mordor",
            "to infinity and beyond",
            "show me the money",
            "winter is coming",
            "bond james bond",
            "i see dead people",
            "life is like a box of chocolates",
            "hasta la vista baby",
            "houston we have a problem",
            "here is johnny",
            "my precious",
            "keep your friends close",
            "et phone home",
            "just keep swimming",
            "elementary my dear watson",
            "say hello to my little friend",
            "do not go gentle into that good night"
        ];

        let currentPhraseIndex = -1; 
        let typedText = "";

        // --- 3. INITIALIZATION (Fixes the 'Start' button issue) ---
        window.addEventListener('DOMContentLoaded', () => {
            
            // Build Keyboard
            initKeyboard();
            
            // Setup Special Keys (Space, Enter, etc)
            setupSpecialKey('key-space', ' ');
            setupSpecialKey('key-enter', 'ENTER');
            setupSpecialKey('key-123', '123');

            // Check URL for Challenges
            const urlParams = new URLSearchParams(window.location.search);
            const challengeIndex = urlParams.get('p');
            const startBtn = document.querySelector('#start-screen .cta');

            if (challengeIndex !== null && phrases[challengeIndex]) {
                // VS Mode
                currentPhraseIndex = parseInt(challengeIndex);
                document.getElementById('challenge-msg').style.display = 'block';
                document.getElementById('challenge-msg').innerHTML = "<span style='color:#fff'>ðŸŽ¥ AUDITION CALL</span><br>Beat this score.";
                
                startBtn.innerText = "ACCEPT ROLE";
                startBtn.addEventListener('click', () => startSpecificGame(currentPhraseIndex));
            } else {
                // Random Mode
                startBtn.addEventListener('click', startGame);
            }
        });

        // --- 4. KEYBOARD BUILDER ---
        function initKeyboard() {
            const row1Keys = "qwertyuiop".split("");
            const row2Keys = "asdfghjkl".split("");
            const row3Keys = "zxcvbnm".split("");

            renderRow('row1', row1Keys);
            renderRow('row2', row2Keys);
            
            const r3 = document.getElementById('row3');
            r3.innerHTML = ''; // Clear to be safe

            // Shift
            let shift = document.createElement('div');
            shift.className = 'key special';
            shift.innerHTML = '<span>â¬†</span>'; 
            r3.appendChild(shift);

            // Letters
            row3Keys.forEach(char => {
                createKey(r3, char);
            });

            // Backspace
            let back = document.createElement('div');
            back.className = 'key special';
            back.innerHTML = '<span>âŒ«</span>';
            // Attach events
            back.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey('BACKSPACE'); });
            back.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey('BACKSPACE'); });
            r3.appendChild(back);
        }

        function renderRow(id, keys) {
            const row = document.getElementById(id);
            row.innerHTML = '';
            keys.forEach(char => createKey(row, char));
        }

        function createKey(parent, char) {
            let k = document.createElement('div');
            k.className = 'key';
            k.innerHTML = `<span>${char.toUpperCase()}</span>`;
            
            // Dual event listeners for instant response
            k.addEventListener('touchstart', (e) => { e.preventDefault(); handleKey(char); });
            k.addEventListener('mousedown', (e) => { e.preventDefault(); handleKey(char); });
            
            parent.appendChild(k);
        }

        function setupSpecialKey(id, action) {
            const el = document.getElementById(id);
            if(!el) return;
            
            el.addEventListener('touchstart', (e) => { 
                e.preventDefault(); 
                if(action === 'ENTER') submitGame();
                else handleKey(action); 
            });
            el.addEventListener('mousedown', (e) => { 
                e.preventDefault(); 
                if(action === 'ENTER') submitGame();
                else handleKey(action); 
            });
        }

        // --- 5. GAME LOGIC ---
        function startGame() {
            const randomIndex = Math.floor(Math.random() * phrases.length);
            startSpecificGame(randomIndex);
        }

        function startSpecificGame(index) {
            currentPhraseIndex = index;
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            const urlParams = new URLSearchParams(window.location.search);
            const title = document.getElementById('mode-title');
            
            if(urlParams.get('p')) {
                title.innerText = "AUDITION MODE";
                title.style.color = "#ff4444";
            } else {
                title.innerText = "MOVIE QUOTES";
                title.style.color = "#fff";
            }

            document.getElementById('target-text').innerText = `"${phrases[index]}"`;
            typedText = "";
            updateDisplay();
        }

        function handleKey(key) {
            if (navigator.vibrate) try { navigator.vibrate(5); } catch(e){}

            if (key === 'BACKSPACE') {
                typedText = typedText.slice(0, -1);
            } else if (key === '123') {
                // ignore
            } else {
                typedText += key;
            }
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('user-input').innerText = typedText + "|"; 
        }

        function submitGame() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';

            const target = phrases[currentPhraseIndex];
            const score = calculateScore(target, typedText);
            
            document.getElementById('score-display').innerText = score + "%";
            document.getElementById('res-goal').innerText = target;
            document.getElementById('res-user').innerText = typedText;

            let roast = "";
            if(score === 100) roast = "ðŸ† OSCAR WORTHY.";
            else if(score > 90) roast = "ðŸ¿ The force is strong with this one.";
            else if(score > 75) roast = "Not bad kid, do not get cocky.";
            else if(score > 50) roast = "You are definitely an extra.";
            else roast = "ðŸ’€ Cut! That was terrible.";
            
            document.getElementById('roast-msg').innerText = roast;
        }

        function resetGame() {
            // Clear URL params
            window.history.pushState({}, document.title, window.location.pathname);
            
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('challenge-msg').style.display = 'none';
            
            // Reset Button logic to default
            const startBtn = document.querySelector('#start-screen .cta');
            startBtn.innerText = "START SCENE";
            
            // Clone button to remove old event listeners cleanly
            const newBtn = startBtn.cloneNode(true);
            startBtn.parentNode.replaceChild(newBtn, startBtn);
            newBtn.addEventListener('click', startGame);
        }

        // --- 6. MATH ---
        function calculateScore(target, attempt) {
            if (!attempt) return 0;
            target = target.toLowerCase();
            attempt = attempt.toLowerCase();
            const distance = levenshtein(target, attempt);
            const maxLength = Math.max(target.length, attempt.length);
            let accuracy = ((maxLength - distance) / maxLength) * 100;
            return Math.max(0, Math.floor(accuracy));
        }

        function levenshtein(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1, 
                            Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1)
                        );
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        // --- 7. SHARING ---
        async function shareResult() {
            const score = document.getElementById('score-display').innerText;
            const currentUrl = window.location.href.split('?')[0]; 
            const challengeLink = `${currentUrl}?p=${currentPhraseIndex}`;
            
            const shareData = {
                title: 'Ghost Cinema',
                text: `ðŸŽ¬ I got ${score} accuracy on the Ghost Keyboard.\nTry to beat me:\n`,
                url: challengeLink
            };

            if (navigator.share) {
                try { await navigator.share(shareData); } catch (err) {}
            } else {
                const textToCopy = `${shareData.text} ${challengeLink}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const btn = document.querySelector('#result-screen .cta');
                    const originalText = btn.innerText;
                    btn.innerText = "LINK COPIED! âœ…";
                    setTimeout(() => { btn.innerText = originalText; }, 2000);
                });
            }
        }
    </script>
</body>
</html>
